import{_ as j,f as G,i as N,u as q,j as I,r as i,m as b,k as B,n as y,A as Q,s as l,g as D,t as p,q as a,v,x as k,y as U,B as d,z as M,H,D as _,b5 as S,L,C as R,ay as F}from"./index.13618ae8.js";import{Q as J}from"./QToolbarTitle.182ac388.js";import{Q as K}from"./QSpace.09136e96.js";import{Q as O}from"./QList.f187b267.js";import{Q as W}from"./QHeader.61458c32.js";import{Q as C}from"./QTd.e519db21.js";import{Q as X}from"./QTable.be9fd74c.js";import{Q as Y,a as Z}from"./QLayout.06e87e2d.js";import{u as x}from"./use-quasar.586811c3.js";import"./QScrollObserver.fa57fc60.js";import"./QSelect.cf7081a4.js";import"./format.d6a55932.js";import"./position-engine.65a8dbe2.js";const ee=G({name:"UserPage",setup(){const e=N("store"),r=x();q(),I();const c=D().appContext.config.globalProperties.$baseUrl;i(!!e.state.token);const A=i(e.state.user.isAdmin),h=i(`${c}avatars/${e.state.user.username}.jpg`),t=i(),n=i([]);let f=[];b.is.desktop||b.is.platform=="ipad"?f=[{name:"picture",align:"center",label:"\u0E23\u0E39\u0E1B",field:"username",sortable:!0},{name:"username",align:"center",label:"\u0E40\u0E25\u0E02\u0E1B\u0E23\u0E30\u0E08\u0E33\u0E15\u0E31\u0E27",field:"username",sortable:!0},{name:"name",align:"left",label:"\u0E0A\u0E37\u0E48\u0E2D \u0E19\u0E32\u0E21\u0E2A\u0E01\u0E38\u0E25",field:"name",sortable:!0},{name:"position",align:"left",label:"\u0E15\u0E33\u0E41\u0E2B\u0E19\u0E48\u0E07",field:"position",sortable:!0},{name:"dept",align:"left",label:"\u0E2A\u0E31\u0E07\u0E01\u0E31\u0E14",field:"dept",sortable:!0},{name:"isadmin",align:"center",label:"Admin",field:"isAdmin",sortable:!0}]:f=[{name:"picture",align:"center",label:"\u0E23\u0E39\u0E1B",field:"username",sortable:!0},{name:"name",align:"left",label:"\u0E0A\u0E37\u0E48\u0E2D \u0E19\u0E32\u0E21\u0E2A\u0E01\u0E38\u0E25",field:"name",sortable:!0},{name:"isadmin",align:"center",label:"Admin",field:"isAdmin",sortable:!0}];const u=i([]),g={"Content-Type":"application/json",Authorization:e.state.token},T=()=>p.post("/getuser",{},{headers:{"Content-Type":"application/json",Authorization:e.state.token}}).then(s=>s.data.results),P=s=>s.length!=6?(m("EMPN allow only exactly 6 digits"),!1):p.post("/adduser",{data:{username:s}},{headers:g}).then(o=>o.data.results),m=s=>{r.notify({position:"top",message:s,color:"purple"})},V=async()=>{const s=await P(t.value);console.log("user",s),t.value="",s?n.value.push({username:s.username,isAdmin:s.isAdmin,name:s.userEGAT.person_thai_name,position:s.userEGAT.person_position,dept:s.userEGAT.main_org_thai_name_reverse_path}):m("EMPN is not found or already added. ")},$=()=>{console.log(u.value),p.post("/deleteuser",{data:u.value},{headers:g}).then(s=>{console.log(s.data),u.value.map(o=>{n.value=n.value.filter(z=>z.username!=o.username)}),m("Delete user done.")})},E=s=>{console.log("update is admin",s),p.post("/updateisadmin",{data:s},{headers:g}).then(o=>{console.log(o.data),m("Update Admin user")})};return B(async()=>{A.value=e.state.user.isAdmin;const s=await T();n.value=s.map(o=>({username:o.username,isAdmin:o.isAdmin,name:o.userEGAT.person_thai_name,position:o.userEGAT.person_position,dept:o.userEGAT.main_org_thai_name_reverse_path})),console.log("users",n.value)}),{Platform:b,updateIsAdmin:E,clickDeleteUser:$,clickAddUser:V,empn:t,users:n,columns:f,selected:u,avatarUrl:h,store:e,baseUrl:c}}}),se={class:"q-pa-sm"},ae=["src"],te={class:"row justify-center q-my-lg"},le=["src"];function oe(e,r,w,c,A,h){return y(),Q(Y,{view:"hHh lpr fff"},{default:l(()=>[a(W,{elevated:"",class:"bg-grey-9 text-grey-1"},{default:l(()=>[a(O,{class:"bg-grey-9 text-grey-1"},{default:l(()=>[a(J,null,{default:l(()=>[a(v,null,{default:l(()=>[a(k,{size:"md",name:"people"})]),_:1}),U("User ")]),_:1}),a(K),d("div",se,[a(v,{size:"sm"},{default:l(()=>[d("img",{src:e.avatarUrl},null,8,ae)]),_:1}),U(" "+M(e.store.state.user.userEGAT.person_thai_name),1)]),a(H,{dark:"",vertical:""}),a(_,{class:"",rounded:"",flat:"",color:"grey-1",to:"/","icon-right":"close",label:"Close"})]),_:1})]),_:1}),a(Z,null,{default:l(()=>[d("div",te,[d("div",{class:S(e.Platform.is.desktop?"col-6":"col-11")},[a(L,{filled:"",color:"purple-12",modelValue:e.empn,"onUpdate:modelValue":r[0]||(r[0]=t=>e.empn=t),label:"EMPN",mask:"######",rules:"val => val && val.length === 6 || 'Input must be 6 digits'",class:"q-my-none"},{prepend:l(()=>[a(k,{name:"person_add"})]),append:l(()=>[a(_,{size:"lg",title:"add user",round:"",dense:"",flat:"",icon:"add",onClick:e.clickAddUser},null,8,["onClick"]),e.selected.length?(y(),Q(_,{key:0,size:"md",title:"delete user",round:"",dense:"",flat:"",icon:"delete",onClick:e.clickDeleteUser,color:"red"},null,8,["onClick"])):R("",!0)]),_:1},8,["modelValue"]),a(X,{class:"q-my-none",title:"Users",rows:e.users,columns:e.columns,"row-key":"username",selection:"multiple",selected:e.selected,"onUpdate:selected":r[1]||(r[1]=t=>e.selected=t),pagination:{rowsPerPage:50}},{"body-cell-isadmin":l(t=>[a(C,{props:t},{default:l(()=>[a(F,{modelValue:t.row.isAdmin,"onUpdate:modelValue":[n=>t.row.isAdmin=n,n=>e.updateIsAdmin(t.row)]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-picture":l(t=>[a(C,{props:t},{default:l(()=>[a(v,{size:"xl"},{default:l(()=>[d("img",{src:`${e.baseUrl}avatars/${t.row.username}.jpg`},null,8,le)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])],2)])]),_:1})]),_:1})}var Ae=j(ee,[["render",oe]]);export{Ae as default};
