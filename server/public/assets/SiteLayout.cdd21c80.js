import{c as ue,b as K,d as de,h as ce,_ as me,f as pe,i as fe,r as c,j as ge,u as he,w as ve,k as be,m as ke,b3 as we,n as l,A as r,s as t,g as _e,t as S,P as R,q as a,x as w,C as d,p as _,z as m,H as L,B as b,y as s,D as M,E as F,b4 as C,v as O,F as B,b5 as Ce,ai as T}from"./index.16a70692.js";import{Q as ye}from"./QSpace.81195a6b.js";import{Q as Qe,e as V,c as f,d as y,b as p,a as U}from"./QItemLabel.62d201fd.js";import{Q as X}from"./format.33ca9c68.js";import{Q as $e,a as De}from"./QDrawer.3696a311.js";import{Q as ze}from"./QHeader.3ee1a58c.js";import{Q as Ae,a as qe}from"./QLayout.95616dd2.js";import{C as D}from"./ClosePopup.2dedddb2.js";import{u as Pe}from"./use-quasar.a1d32e16.js";import{d as Se,l as Le,a as Me,s as Oe}from"./index.b485f810.js";import"./position-engine.11d69935.js";import"./QScrollObserver.71d28cb5.js";import"./index.58290dd4.js";const Be=["top","middle","bottom"];var Y=ue({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Be.includes(e)}},setup(e,{slots:u}){const z=K(()=>e.align!==void 0?{verticalAlign:e.align}:null),$=K(()=>{const h=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(h!==void 0?` text-${h}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>de("div",{class:$.value,style:z.value,role:"status","aria-label":e.label},ce(u.default,e.label!==void 0?[e.label]:[]))}});const Te=pe({name:"SiteLayout",setup(){const e=fe("store"),u=Pe(),z=_e(),$=c(z.appContext.config.globalProperties.$baseUrl),h=ge(),H=he(),g=c(H.params.site),o=c(),v=c(!!e.state.token),A=c(e.state.user.isAdmin),Z=c(`${$.value}avatars/${e.state.user.username}.jpg`),J=c(e.state.user),Q=[{id:1,icon:"panorama_photosphere",label:"VirtualTour",separator:!0,to:""},{id:10,icon:"thunderstorm",label:"Weather",separator:!0,to:"weather"}],j=c("photosphere"),x=c([]),I=c(null),E=c(!1),q=c("1"),P=c([]);ve(j,n=>{n=="photosphere"?h.push({path:"/"+g.value}):h.push({path:"/"+g.value+"/"+n})},{deep:!0});const ee=()=>S.post("/loadsites",{data:{site:g.value}},{headers:{"Content-Type":"application/json",Authorization:e.state.token}}).then(n=>n.data.results),W=n=>S.post("/getnotification",{data:{site_id:n}},{headers:{"Content-Type":"application/json",Authorization:e.state.token}}).then(i=>i.data.results),te=n=>S.post("/getcctv",{data:{site_id:n}},{headers:{"Content-Type":"application/json",Authorization:e.state.token}}).then(i=>i.data.results),ae=()=>{e.state.token="",e.state.user="",R.remove("token"),v.value=!1,Oe("User Logout")},oe=()=>{window.orientation===0||window.orientation===180?I.value="vertical":I.value="horizontal"},le=n=>{h.push({path:"/"+g.value+"/"+n.to}),q.value=n,E.value=!1},G=c([]),ne=async n=>S.post("/getphoto_info",{data:{p:n}},{headers:{"Content-Type":"application/json",Authorization:e.state.token}}).then(i=>i.data.results);be(async()=>{E.value=!1;const n=await ee(),i=h.currentRoute.value.path.split("/");i.length>2&&(j.value=i[i.length-1]),o.value=n[0],o.value.photos.sort((k,N)=>new Date(N.timestamp)-new Date(k.timestamp)),G.value=await ne(o.value.photos),Q.push({id:5,icon:"map",label:"GeoMap",separator:!0,to:"geomap"}),G.value.findIndex(k=>typeof k[0].gps.GPSLongitude!="undefined"),await te(g.value)!=null&&Q.push({id:13,icon:"vrpano",label:"CCTV",separator:!0,to:"cctv"}),J.value.username&&(P.value=await W(g.value),e.state.total_comment=P.value.length,e.state.total_photo=o.value.photos.length),i.length==2&&(q.value=Q[0]),i.length>2&&(q.value=Q.filter(k=>k.to==i[2])[0]),Q.sort((k,N)=>k.id-N.id),window.addEventListener("resize",oe)});const se=async()=>{P.value=await W(g.value)},re=n=>{console.log("gotoPoint",n);const i={site_id:n.comment.site_id,map_id:n.comment.map_id,point_id:n.comment.point_id,photo_id:n.comment.photo_id};console.log("routeCache",i),R.set("route",i),h.go(0)},ie=n=>{console.log("gotoPhoto",n);const i={site_id:g.value,map_id:n[0].map.id,point_id:n[0].point.id,photo_id:n[0].id};console.log("routeCache",i),R.set("route",i),h.go(0)};return{screen:c(u.screen),gotoPhoto:ie,photos:G,getComments:se,comments:P,store:e,dateString:Se,localDateString:Le,dAgo:Me,baseUrl:$,gotoPoint:re,selectedMenu:q,clickMenu:le,menuList:Q,leftDrawerOpen:E,orientation:I,Platform:ke,notifications:x,logout:ae,avatarUrl:Z,menu:j,authorized:v,isAdmin:A,site:g,siteInfo:o,user:J}}}),Ve={key:0,class:"q-mr-lg text-subtitle1"},Ue={class:"text-deep-orange q-ml-sm"},je={style:{width:"350px"}},Ie=["src"],Ee={style:{width:"450px"}},Ge=["src"],Ne={class:"row items-center no-wrap"},Re=["src"],Fe=["src"],He=b("span",{class:"text-deep-orange"},"V",-1);function Je(e,u,z,$,h,H){const g=we("router-view");return l(),r(Ae,{view:"lHh lpR fFf",class:"bg-grey-12"},{default:t(()=>[a(ze,{elevated:"",class:"bg-grey-9 text-grey-1"},{default:t(()=>[a(Qe,{class:"q-pa-none"},{default:t(()=>[e.leftDrawerOpen?d("",!0):(l(),r(w,{key:0,class:"q-mx-sm",name:"menu",size:"md",onClick:u[0]||(u[0]=o=>e.leftDrawerOpen=!e.leftDrawerOpen)})),e.orientation=="horizontal"&&!e.leftDrawerOpen?(l(),_("div",{key:1,class:"q-mr-lg text-subtitle1",onClick:u[1]||(u[1]=o=>e.leftDrawerOpen=!e.leftDrawerOpen)},m(e.siteInfo.name),1)):(l(),_("div",{key:2,onClick:u[2]||(u[2]=o=>e.leftDrawerOpen=!e.leftDrawerOpen)},[e.siteInfo&&(e.Platform.is.desktop||e.Platform.is.platform=="ipad")&&!e.leftDrawerOpen?(l(),_("div",Ve,m(e.siteInfo.name),1)):d("",!0)])),a(L,{dark:"",vertical:""}),b("div",Ue,[a(w,{class:"q-mx-sm",name:e.selectedMenu.icon,size:"sm"},null,8,["name"]),s(m(e.selectedMenu.label),1)]),a(ye),e.authorized&&e.selectedMenu.id=="1"?(l(),r(M,{key:3,round:"",flat:"",icon:"add_a_photo"},{default:t(()=>[e.store.state.total_photo?(l(),r(Y,{key:0,color:"red",floating:"",transparent:""},{default:t(()=>[s(m(e.store.state.total_photo),1)]),_:1})):d("",!0),a(X,null,{default:t(()=>[b("div",je,[a(V,{separator:"",bordered:""},{default:t(()=>[a(f,{header:"",class:"text-weight-bold"},{default:t(()=>[s("Latest Uploads")]),_:1}),(l(!0),_(B,null,F(e.photos,(o,v)=>C((l(),r(y,{key:v,clickable:"",onClick:A=>e.gotoPhoto(o)},{default:t(()=>[a(p,{top:"",avatar:""},{default:t(()=>[a(O,null,{default:t(()=>[b("img",{src:`${e.baseUrl}avatars/${o[o.length-1].user.username}.jpg`},null,8,Ie)]),_:2},1024)]),_:2},1024),a(p,{top:""},{default:t(()=>[a(f,{class:"text-weight-light",caption:"",lines:"1"},{default:t(()=>[s(m(e.dateString(o[o.length-1].point.timestamp)),1)]),_:2},1024),a(f,{caption:"",lines:"3"},{default:t(()=>[s(m(o[o.length-1].map.name)+": "+m(o[o.length-1].point.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[T],[D]])),128))]),_:1})])]),_:1})]),_:1})):d("",!0),e.authorized&&e.selectedMenu.id=="1"?(l(),r(M,{key:4,round:"",flat:"",icon:"chat",onClick:u[3]||(u[3]=o=>e.getComments())},{default:t(()=>[e.store.state.total_comment?(l(),r(Y,{key:0,color:"red",floating:"",transparent:""},{default:t(()=>[s(m(e.store.state.total_comment),1)]),_:1})):d("",!0),a(X,null,{default:t(()=>[b("div",Ee,[a(V,{bordered:""},{default:t(()=>[a(f,{header:"",class:"text-weight-bold"},{default:t(()=>[s("Comments")]),_:1}),(l(!0),_(B,null,F(e.comments,(o,v)=>C((l(),r(y,{key:v,clickable:"",onClick:A=>e.gotoPoint(o)},{default:t(()=>[o.postby[0].username?(l(),r(p,{key:0,avatar:""},{default:t(()=>[a(O,{size:"xl"},{default:t(()=>[b("img",{src:`${e.baseUrl}avatars/${o.postby[0].username}.jpg`},null,8,Ge)]),_:2},1024)]),_:2},1024)):d("",!0),a(p,{top:""},{default:t(()=>[a(f,{class:"text-weight-bold",caption:"",lines:"1"},{default:t(()=>[s(m(o.point[0].name),1)]),_:2},1024),a(f,{caption:"",lines:"3"},{default:t(()=>[s(m(o.comment.text),1)]),_:2},1024)]),_:2},1024),a(p,{side:"",top:""},{default:t(()=>[a(f,{caption:""},{default:t(()=>[s(m(e.dAgo(o.comment.id)),1)]),_:2},1024),o.comment.tag=="goodjob"?(l(),r(U,{key:0,dense:"",color:"teal","text-color":"white",icon:"thumb_up"},{default:t(()=>[s("Good Job")]),_:1})):d("",!0),o.comment.tag=="defect"?(l(),r(U,{key:1,dense:"",color:"red","text-color":"white",icon:"build_circle"},{default:t(()=>[s("Defect")]),_:1})):d("",!0),o.comment.tag=="action"?(l(),r(U,{key:2,dense:"",color:"green","text-color":"white",icon:"schedule"},{default:t(()=>[s("Action")]),_:1})):d("",!0),o.comment.tag=="question"?(l(),r(U,{key:3,dense:"",color:"primary","text-color":"white",icon:"help"},{default:t(()=>[s("Question")]),_:1})):d("",!0)]),_:2},1024)]),_:2},1032,["onClick"])),[[T],[D]])),128))]),_:1})])]),_:1})]),_:1})):d("",!0),e.authorized?(l(),r($e,{key:5,flat:""},{label:t(()=>[b("div",Ne,[a(O,{size:"md"},{default:t(()=>[b("img",{src:e.avatarUrl},null,8,Re)]),_:1})])]),default:t(()=>[a(V,{style:{width:"280px"}},{default:t(()=>[C((l(),r(y,{clickable:""},{default:t(()=>[a(p,{side:""},{default:t(()=>[a(O,{size:"32px"},{default:t(()=>[b("img",{src:e.avatarUrl},null,8,Fe)]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(f,null,{default:t(()=>[s(m(e.user.userEGAT.person_thai_name),1)]),_:1}),a(f,{caption:""},{default:t(()=>[s(m(e.user.userEGAT.person_position),1)]),_:1}),a(f,{caption:""},{default:t(()=>[s(m(e.user.userEGAT.main_org_thai_name_reverse_path),1)]),_:1})]),_:1})]),_:1})),[[T]]),a(L,{spaced:""}),e.isAdmin&&e.selectedMenu.id=="1"?C((l(),r(y,{key:0,clickable:"",to:"/"+e.site+"/map",exact:""},{default:t(()=>[a(p,{avatar:""},{default:t(()=>[a(w,{name:"map",color:"primary","text-color":"white"})]),_:1}),a(p,null,{default:t(()=>[a(f,null,{default:t(()=>[s("Map")]),_:1})]),_:1})]),_:1},8,["to"])),[[D]]):d("",!0),e.isAdmin&&e.selectedMenu.id=="5"?C((l(),r(y,{key:1,clickable:"",to:"/"+e.site+"/upload",exact:""},{default:t(()=>[a(p,{avatar:""},{default:t(()=>[a(w,{name:"upload",color:"primary","text-color":"white"})]),_:1}),a(p,null,{default:t(()=>[a(f,null,{default:t(()=>[s("Upload Photos")]),_:1})]),_:1})]),_:1},8,["to"])),[[D]]):d("",!0),C((l(),r(y,{clickable:"",onClick:e.logout},{default:t(()=>[a(p,{avatar:""},{default:t(()=>[a(w,{name:"logout",color:"primary","text-color":"white"})]),_:1}),a(p,null,{default:t(()=>[a(f,null,{default:t(()=>[s("Logout")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[D]])]),_:1})]),_:1})):d("",!0),e.authorized?d("",!0):(l(),r(M,{key:6,flat:"",icon:"login",label:"Login",to:"/login"})),a(L,{dark:"",vertical:""}),a(M,{rounded:"",flat:"","icon-right":"close",to:"/",label:e.screen.name=="xs"?"":"Close"},null,8,["label"])]),_:1})]),_:1}),a(De,{modelValue:e.leftDrawerOpen,"onUpdate:modelValue":u[5]||(u[5]=o=>e.leftDrawerOpen=o),width:288,breakpoint:500,bordered:"",dark:"",class:Ce(e.$q.dark.isActive?"bg-grey-1":"bg-grey-9")},{default:t(()=>[a(w,{class:"q-mx-sm",name:"menu",size:"md",onClick:u[4]||(u[4]=o=>e.leftDrawerOpen=!e.leftDrawerOpen)}),s(" mySites"),He,s("ision "),a(V,null,{default:t(()=>[(l(!0),_(B,null,F(e.menuList,(o,v)=>(l(),_(B,{key:v},[C((l(),r(y,{clickable:"",active:o.id==e.selectedMenu.id,"active-class":"bg-grey-1 text-grey-8",onClick:A=>e.clickMenu(o)},{default:t(()=>[a(p,{avatar:""},{default:t(()=>[a(w,{name:o.icon},null,8,["name"])]),_:2},1024),a(p,null,{default:t(()=>[s(m(o.label),1)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[T]]),o.separator?(l(),r(L,{key:"sep"+v})):d("",!0)],64))),128))]),_:1})]),_:1},8,["modelValue","class"]),a(qe,null,{default:t(()=>[a(g)]),_:1})]),_:1})}var it=me(Te,[["render",Je]]);export{it as default};
